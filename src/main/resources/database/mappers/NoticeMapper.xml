<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.coffice.app.posts.notice.NoticeDAO">
  	
  	<insert id="add" parameterType="noticeVO">
  		INSERT INTO NOTICE(NOTICE_NUM, USER_ID, NOTICE_TITLE, NOTICE_CONTENTS, NOTICE_HIT, NOTICE_DATE) 
  		VALUES(null, #{userId}, #{noticeTitle}, #{noticeContents}, 0, NOW())
  	</insert>
  	
  	<select id="getList" parameterType="Pager" resultType="NoticeVO">
  		SELECT * FROM NOTICE
  		<include refid="search"></include>
  		ORDER BY NOTICE_NUM DESC
  		LIMIT #{startNum}, #{page}
  	</select>
  	
  	<sql id="search">
  		WHERE
  			<choose>
  				<when test="kind == 'k1'">
  					NOTICE_TITLE LIKE CONCAT('%', #{search}, '%')
  				</when>
  				<when test="kind == 'k2'">
  					NOTICE_CONTENTS LIKE CONCAT('%', #{search}, '%')
  				</when>
  				<otherwise>
  					NOTICE_TITLE LIKE CONCAT('%', #{search}, '%') OR NOTICE_CONTENTS LIKE CONCAT('%', #{search}, '%')
  				</otherwise>
  			</choose>
  	</sql>
  	
  	<select id="getTotalCount" resultType="Long" parameterType="Pager">
  		SELECT COUNT(*) FROM NOTICE
  		<include refid="search"></include>
  	</select>
  	
  	<select id="getDetail" parameterType="NoticeVO" resultType="NoticeVO">
  		SELECT * FROM NOTICE
  		WHERE NOTICE_NUM = #{noticeNum}
  	</select>
  </mapper>